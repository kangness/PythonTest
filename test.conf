# OpenResty Tester Deployment Script for FreeBSD 9

jobs = 2;
ngx_redis_version = 0.3.6;
nginx_version = 1.2.4;
openresty_version = 1.2.4.7rc4;
redis_version = 2.4.17;
ngx_auth_request_version = 0.2;
pcre_version = 8.31;
force = 0;
ragel_version = 6.7;
libev_version = 4.11;


etcproxy {
    git git://github.com/chaoslawful/etcproxy.git ~/git/etcproxy;
    dep erlang;
}

erlang {
    prog erl erlc;
    yum erlang;
}

ngx_srcache {
    git git://github.com/agentzh/srcache-nginx-module.git ~/git/srcache-nginx-module;
    dep ndk ngx_set_misc ngx_redis ngx_xss;
    dep ngx_redis2 ngx_eval ngx_echo ngx_headers_more;
    dep ngx_lua ngx_rds_json ngx_drizzle ngx_postgres;
    dep ngx_memc;
}

ngx_memc {
    git git://github.com/agentzh/memc-nginx-module.git ~/git/memc-nginx-module;
    dep ragel;
}

ragel {
    prog ragel;
    cwd /tmp;
    fetch http://www.complang.org/ragel/ragel-$ragel_version.tar.gz;
    tarball ragel-$ragel_version.tar.gz;
    sh 'cd ragel-$ragel_version && ./configure && gmake -j$jobs && sudo gmake install';
    dep cxx;
}

cxx {
    prog g++;
    yum gcc-c++;
    dep make;
}

ngx_postgres {
    git git://github.com/FRiCKLE/ngx_postgres.git ~/git/postgres-nginx-module;
    env LIBPQ_INC /usr/include;
    env LIBPQ_LIB /usr/lib64;
    dep libpq;
}

libpq {
    file /usr/local/lib/libpq.so;
    file /usr/local/include/libpq-fe.h;
    yum postgresql91-client;
}

ngx_drizzle {
    env LIBDRIZZLE_INC /opt/drizzle/include/libdrizzle-1.0;
    env LIBDRIZZLE_LIB /opt/drizzle/lib;

    git git://github.com/chaoslawful/drizzle-nginx-module.git ~/git/drizzle-nginx-module;
    dep libdrizzle;
}

libdrizzle {
    file /opt/drizzle/lib/libdrizzle.so;
    file /opt/drizzle/include/libdrizzle-1.0/libdrizzle/drizzle.h;
    cwd /tmp;
    fetch http://agentzh.org/misc/nginx/drizzle7-2011.07.21.tar.gz;
    tarball drizzle7-2011.07.21.tar.gz;
    sh 'cd drizzle7-2011.07.21/ && ./configure --without-server --prefix=/opt/drizzle && gmake libdrizzle-1.0 && sudo gmake install-libdrizzle-1.0';
    dep cc;
}

ngx_rds_json {
    git git://github.com/agentzh/rds-json-nginx-module.git ~/git/rds-json-nginx-module;
}

ngx_rds_csv {
    git git://github.com/agentzh/rds-csv-nginx-module.git ~/git/rds-csv-nginx-module;
}

ngx_array_var {
    git git://github.com/agentzh/array-var-nginx-module.git ~/git/array-var-nginx-module;
    dep ndk;
}

ngx_encrypted_session {
    git git://github.com/agentzh/encrypted-session-nginx-module.git ~/git/encrypted-session-nginx-module;
    dep ndk;
}

ngx_form_input {
    git git://github.com/calio/form-input-nginx-module ~/git/form-input-nginx-module;
    dep ndk;
}

ngx_xss {
    git git://github.com/agentzh/xss-nginx-module.git ~/git/xss-nginx-module;
    dep ragel;
}

ngx_redis2 {
    git git://github.com/agentzh/redis2-nginx-module.git ~/git/redis2-nginx-module;
    dep ragel;
}

ngx_eval {
    git git://github.com/agentzh/nginx-eval-module.git ~/git/eval-nginx-module;
}

ngx_echo {
    git git://github.com/agentzh/echo-nginx-module.git ~/git/echo-nginx-module;
}

ngx_example_lua {
    git git://github.com/agentzh/nginx-example-lua-module.git ~/git/example-lua-nginx-module;

    env LD_LIBRARY_PATH /usr/local/openresty-debug/luajit/lib:$LD_LIBRARY_PATH;
    env LUAJIT_LIB /usr/local/openresty-debug/luajit/lib;
    env LUAJIT_INC /usr/local/openresty-debug/luajit/include/luajit-2.0;
    dep ngx_lua;
}

ngx_lua {
    git git://github.com/chaoslawful/lua-nginx-module.git ~/git/lua-nginx-module;

    env LD_LIBRARY_PATH /usr/local/openresty-debug/luajit/lib:$LD_LIBRARY_PATH;
    env LUAJIT_LIB /usr/local/openresty-debug/luajit/lib;
    env LUAJIT_INC /usr/local/openresty-debug/luajit/include/luajit-2.0;
    dep luajit ndk;
}

pcrejit {
    env PCRE_LIB /opt/pcrejit/lib;
    env PCRE_INC /opt/pcrejit/include;

    file /opt/pcrejit/lib/libpcre.so;
    file /opt/pcrejit/include/pcre.h;

    fetch ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-$pcre_version.tar.gz;
    tarball pcre-$pcre_version.tar.gz;
    cwd /tmp;
    sh 'cd pcre-$pcre_version && ./configure --enable-jit --enable-utf8 --prefix=/opt/pcrejit && gmake -j$jobs && sudo gmake install';
}

ngx_auth_request {
    file ~/work/nginx/ngx_http_auth_request_module-$ngx_auth_request_version;
    cwd ~/work/nginx;
    fetch http://mdounin.ru/files/ngx_http_auth_request_module-$ngx_auth_request_version.tar.gz;
    tarball ngx_http_auth_request_module-$ngx_auth_request_version.tar.gz;
}

ngx_coolkit {
    git git://github.com/FRiCKLE/ngx_coolkit.git ~/git/coolkit-nginx-module;
}

luajit {
    dep ngx_openresty-debug;
}

ngx_openresty-debug {
    test '/usr/local/openresty-debug/nginx/sbin/nginx -V 2>&1 |grep "$openresty_version$"';
    file /usr/local/openresty-debug/luajit/include/luajit-2.0/lua.h;
    file /usr/local/openresty-debug/luajit/lib/libluajit-5.1.a;
    file /usr/local/openresty-debug/nginx/sbin/nginx;
    cwd /tmp;
    fetch http://agentzh.org/misc/nginx/ngx_openresty-$openresty_version.tar.gz;
    tarball ngx_openresty-$openresty_version.tar.gz;
    sh 'cd ngx_openresty-$openresty_version && ./configure --with-cc=gcc47 --prefix=/usr/local/openresty-debug --with-luajit --with-http_drizzle_module --with-libdrizzle=/opt/drizzle --with-http_iconv_module -j$jobs --with-debug --with-luajit-xcflags="-DLUAJIT_USE_VALGRIND -I/opt/valgrind/include" && gmake -j$jobs && sudo gmake install';
    dep libdrizzle openssl pcre valgrind;
}


lua-resty-memcached {
    git git://github.com/agentzh/lua-resty-memcached.git ~/git/lua-resty-memcached;
    dep ngx_lua;
}

lua-resty-redis {
    git git://github.com/agentzh/lua-resty-redis.git ~/git/lua-resty-redis;
    dep ngx_lua;
}

lua-resty-mysql {
    git git://github.com/agentzh/lua-resty-mysql.git ~/git/lua-resty-mysql;
    dep ngx_lua;
}

lua-resty-string {
    git git://github.com/agentzh/lua-resty-string.git ~/git/lua-resty-string;
    dep ngx_lua;
}

lua-resty-upload {
    git git://github.com/agentzh/lua-resty-upload.git ~/git/lua-resty-upload;
    dep ngx_lua;
}

lua-resty-dns {
    git git://github.com/agentzh/lua-resty-dns.git ~/git/lua-resty-dns;
    dep ngx_lua;
}


ngx_headers_more {
    git git://github.com/agentzh/headers-more-nginx-module.git ~/git/headers-more-nginx-module;
}

nginx-devel-utils {
    git git://github.com/agentzh/nginx-devel-utils.git ~/git/nginx-devel-utils;
    dep no-pool-nginx;
    dep ngx_openresty;
    dep patch;
}

ngx_set_misc {
    git git://github.com/agentzh/set-misc-nginx-module ~/git/set-misc-nginx-module;
}

ngx_iconv {
    git git://github.com/calio/iconv-nginx-module ~/git/iconv-nginx-module;
    dep ndk;
}

no-pool-nginx {
    git git://github.com/shrimp/no-pool-nginx.git ~/git/no-pool-nginx;
    dep patch;
}

ngx_openresty {
    git git://github.com/agentzh/ngx_openresty.git ~/git/ngx_openresty;
}

git {
    prog git;
    yum git;
}

mockeagain {
    always;
    #file ~/git/mockeagain/mockeagain.so;
    sh 'cd ~/git/mockeagain && LD_PRELOAD= gmake';
    dep mockeagain-git;
    dep cc libexecinfo;
}

libexecinfo {
    file /usr/local/include/execinfo.h;
    file /usr/local/lib/libexecinfo.so;
    yum libexecinfo;
}

mockeagain-git {
    git git://github.com/agentzh/mockeagain.git ~/git/mockeagain;
}

run-redis {
    running 'redis-server -';
    sh '(echo "daemonize yes"; echo "loglevel warning")|redis-server -';
    dep redis;
}

redis {
    prog redis-server;
    test 'redis-server -v|grep $redis_version';
    cwd /tmp;
    fetch 'http://redis.googlecode.com/files/redis-$redis_version.tar.gz';
    tarball redis-$redis_version.tar.gz;
    sh 'cd redis-$redis_version/ && ARCH= gmake -j$jobs && ARCH= sudo gmake install';
    dep cc;
}

run-postgres {
    running 'postgres: writer process';
    sh 'sudo /usr/local/etc/rc.d/postgresql-server start || (sleep 10 && sudo /usr/local/etc/rc.d/postgresql-server start)';
    dep postgres;
}

postgres {
    prog pg_ctl;
    yum postgresql91-server;

    # vim /var/lib/pgsql9/data/pg_hba.conf
    # psql> create user ngx_test with password 'ngx_test';
    # psql> create database ngx_test;
    # psql> grant all privileges on database ngx_test to ngx_test;
}

run-mysql {
    running 'mysqld --';
    sh 'sudo /usr/local/etc/rc.d/mysql-server start || (sleep 10 && sudo /usr/local/etc/rc.d/mysql-server start)';
    dep mysql;
}

mysql {
    prog mysqld_safe;
    yum mysql55-client mysql55-server;

    # mysql -u root
    # mysql> create database ngx_test;
    # mysql> create user 'ngx_test'@'localhost' identified by 'ngx_test';
    # mysql> grant all privileges on ngx_test.* to 'ngx_test'@'localhost' with grant option;
}

run-memcached {
    running 'memcached -d -p 11211';
    sh 'memcached -d -p 11211 -l 127.0.0.1';
    dep memcached;
}

memcached {
    prog memcached;
    yum memcached;
}

nginx-module-test {
    always;
    env PATH $PWD/work/nginx/sbin:$HOME/git/nginx-devel-utils:$PATH;
    dep prove test-nginx no-pool-nginx nginx-devel-utils axel;
    dep cc openssl pcre;
}

openssl {
    file /usr/include/openssl/md5.h;

    yum openssl-devel;
}

pcre {
    prog pcre-config;
    yum pcre-devel;
}

axel {
    prog axel;
    yum axel;
}

cc {
    prog gcc47;
    yum gcc47;
    dep make;
}

make {
    prog gmake;
    yum gmake;
}

prove {
    prog prove;
    yum p5-Test-Harness;
}

test-nginx {
    git git://github.com/agentzh/test-nginx.git ~/git/test-nginx;
    dep test-base time-hires test-longstring list-moreutils http-response lwp;
    dep ab weighttp;
}

text-diff {
    test 'perl -MText::Diff -e1';
    yum p5-Text-Diff;
}

lwp {
    test 'perl -MLWP::UserAgent -e1';
    yum p5-libwww;
}

http-response {
    test 'perl -MHTTP::Response -e1';
    yum p5-HTTP-Message;
}

ab {
    prog ab;
    yum apache22;
}

weighttp {
    prog weighttp;
    git https://github.com/agentzh/weighttp ~/git/weighttp;
    cwd ~/git/weighttp;
    sh './waf configure && ./waf build && sudo ./waf install';
    dep libev python;
}

python {
    prog python;
    yum python;
}

libev {
    file /usr/local/lib/libev.so;
    file /usr/local/include/ev.h;
    cwd /tmp;
    fetch http://dist.schmorp.de/libev/libev-$libev_version.tar.gz;
    tarball libev-$libev_version.tar.gz;
    sh 'cd libev-$libev_version && ./configure && gmake -j$jobs && sudo gmake install';
    dep cxx cc;
}

list-moreutils {
    test 'perl -MList::MoreUtils -e1';
    yum p5-List-MoreUtils;
}

test-longstring {
    test 'perl -MTest::LongString -e1';
    yum p5-Test-LongString;
}

time-hires {
    test 'perl -MTime::HiRes -e1';
    yum p5-Time-HiRes;
}

test-base {
    test 'perl -e "require(q{Test/Base.pm});"';
    yum p5-Test-Base;
    dep text-diff;
}

patch {
    prog patch;
    yum patch;
}

ndk {
    git git://github.com/simpl/ngx_devel_kit.git ~/git/ndk-nginx-module;
}

ngx_redis {
    file ~/work/nginx/ngx_http_redis-$ngx_redis_version;
    cwd ~/work/nginx;
    fetch http://people.freebsd.org/~osa/ngx_http_redis-$ngx_redis_version.tar.gz;
    tarball ngx_http_redis-$ngx_redis_version.tar.gz;
}

cpan {
    prog cpan;
    yum p5-CPAN;
    dep cc;
}




t-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


t-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

t-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

t-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

t-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

t-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

t-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

t-ngx_lua {
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so $LD_PRELOAD';
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

t-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

t-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

t-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

t-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

t-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

t-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

t-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

t-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

t-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

t-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

t-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

t-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
t-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
t-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
t-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
t-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
t-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


tv-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


tv-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

tv-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

tv-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

tv-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

tv-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

tv-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

tv-ngx_lua {
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so $LD_PRELOAD';
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

tv-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

tv-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

tv-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

tv-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

tv-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

tv-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

tv-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

tv-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

tv-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

tv-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tv-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tv-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
tv-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
tv-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
tv-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
tv-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
tv-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


tr-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


tr-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

tr-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

tr-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

tr-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

tr-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

tr-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

tr-ngx_lua {

    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

tr-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

tr-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

tr-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

tr-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

tr-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

tr-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

tr-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

tr-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

tr-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

tr-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tr-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tr-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
tr-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
tr-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
tr-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
tr-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
tr-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


trv-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


trv-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

trv-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

trv-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

trv-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

trv-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

trv-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

trv-ngx_lua {

    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

trv-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

trv-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

trv-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

trv-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

trv-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

trv-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

trv-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

trv-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

trv-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

trv-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

trv-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

trv-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
trv-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
trv-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
trv-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
trv-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
trv-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    env MOCKEAGAIN r;
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


tw-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


tw-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

tw-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

tw-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

tw-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

tw-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

tw-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

tw-ngx_lua {

    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

tw-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

tw-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

tw-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

tw-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

tw-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

tw-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

tw-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

tw-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

tw-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

tw-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tw-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tw-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
tw-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
tw-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
tw-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
tw-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
tw-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


twv-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


twv-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

twv-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

twv-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

twv-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

twv-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

twv-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

twv-ngx_lua {

    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

twv-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

twv-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

twv-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

twv-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

twv-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

twv-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

twv-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

twv-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

twv-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

twv-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

twv-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

twv-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
twv-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
twv-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
twv-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
twv-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
twv-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    env TEST_NGINX_POSTPONE_OUTPUT 1;
    env TEST_NGINX_EVENT_TYPE poll;
    #env MOCKEAGAIN_VERBOSE 1;
    env MOCKEAGAIN w;
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so';
    dep mockeagain;

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


th-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


th-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

th-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

th-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

th-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

th-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

th-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

th-ngx_lua {
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so $LD_PRELOAD';
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

th-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

th-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

th-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

th-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

th-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

th-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

th-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

th-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

th-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

th-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

th-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

th-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
th-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
th-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
th-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
th-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
th-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


thv-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


thv-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

thv-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

thv-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

thv-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

thv-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

thv-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

thv-ngx_lua {
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so $LD_PRELOAD';
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

thv-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

thv-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

thv-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

thv-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

thv-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

thv-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

thv-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

thv-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

thv-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

thv-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

thv-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

thv-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
thv-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
thv-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
thv-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
thv-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
thv-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';
    env TEST_NGINX_USE_HUP 1;

    env TEST_NGINX_SLEEP 0.015;

    env TEST_NGINX_USE_VALGRIND 1;


    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';    dep valgrind;

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


tl-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


tl-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

tl-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

tl-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

tl-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

tl-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

tl-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

tl-ngx_lua {
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so $LD_PRELOAD';
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

tl-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

tl-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

tl-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

tl-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

tl-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

tl-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

tl-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

tl-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

tl-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

tl-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tl-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

tl-lua-resty-memcached {
    always;
    cwd ~/git/lua-resty-memcached;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-memcached;

    dep build-ngx_lua;
}
tl-lua-resty-redis {
    always;
    cwd ~/git/lua-resty-redis;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-redis;

    dep build-ngx_lua;
}
tl-lua-resty-mysql {
    always;
    cwd ~/git/lua-resty-mysql;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-mysql;

    env TEST_NGINX_MYSQL_PATH /var/lib/mysql/mysql.sock;
    dep build-ngx_lua;
}
tl-lua-resty-string {
    always;
    cwd ~/git/lua-resty-string;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-string;

    dep build-ngx_lua;
}
tl-lua-resty-upload {
    always;
    cwd ~/git/lua-resty-upload;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-upload;

    dep build-ngx_lua;
}
tl-lua-resty-dns {
    always;
    cwd ~/git/lua-resty-dns;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK 1;
    env LD_LIBRARY_PATH /usr/local/lib:$LD_LIBRARY_PATH;

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';

    dep ngx_lua nginx-module-test lua-resty-dns;

    dep build-ngx_lua;
}


to-ngx_srcache {
    always;
    cwd ~/git/srcache-nginx-module;
    env PATH '~/git/srcache-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_srcache;

    dep run-memcached run-redis run-mysql run-postgres;
}


to-ngx_set_misc {
    always;
    cwd ~/git/set-misc-nginx-module;
    env PATH '~/git/set-misc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_set_misc;

    dep ndk ngx_echo ngx_iconv;
}

to-ngx_headers_more {
    always;
    cwd ~/git/headers-more-nginx-module;
    env PATH '~/git/headers-more-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_headers_more;

    dep ngx_eval ngx_echo ngx_lua;
}

to-ngx_rds_json {
    always;
    cwd ~/git/rds-json-nginx-module;
    env PATH '~/git/rds-json-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_json;

    dep run-mysql run-postgres;
    dep ngx_drizzle ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var ngx_form_input ngx_postgres;
}

to-ngx_rds_csv {
    always;
    cwd ~/git/rds-csv-nginx-module;
    env PATH '~/git/rds-csv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_rds_csv;

    dep run-mysql run-postgres;
    dep ngx_eval ngx_echo ngx_xss ndk ngx_set_misc ngx_array_var;
    dep ngx_drizzle ngx_form_input ngx_postgres;
}

to-ngx_drizzle {
    always;
    cwd ~/git/drizzle-nginx-module;
    env PATH '~/git/drizzle-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_drizzle;

    dep run-mysql;
    dep ngx_lua ngx_echo ngx_rds_json;
    dep ngx_headers_more ndk ngx_set_misc;
}

to-ngx_example_lua {
    always;
    cwd ~/git/example-lua-nginx-module;
    env PATH '~/git/example-lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_example_lua;

    dep ngx_echo ngx_lua;
}

to-ngx_lua {
    env LD_PRELOAD '~/git/mockeagain/mockeagain.so $LD_PRELOAD';
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle ngx_srcache;
    dep ngx_rds_json ngx_coolkit;
}

to-ngx_memc {
    always;
    cwd ~/git/memc-nginx-module;
    env PATH '~/git/memc-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_memc;

    dep run-memcached;
    dep ndk ngx_eval ngx_echo ngx_lua;
}

to-ngx_redis2 {
    always;
    cwd ~/git/redis2-nginx-module;
    env PATH '~/git/redis2-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_redis2;

    dep run-redis;
    dep ndk ngx_eval ngx_echo ngx_set_misc ngx_lua;
}

to-ngx_xss {
    always;
    cwd ~/git/xss-nginx-module;
    env PATH '~/git/xss-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_xss;

    dep ngx_echo ndk ngx_lua;
}

to-ngx_echo {
    always;
    cwd ~/git/echo-nginx-module;
    env PATH '~/git/echo-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_echo;

    dep ndk ngx_set_misc ngx_eval ngx_xss;
    dep ngx_rds_json ngx_headers_more ngx_lua;
}

to-ngx_eval {
    always;
    cwd ~/git/eval-nginx-module;
    env PATH '~/git/eval-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_eval;

    dep run-memcached ngx_echo ngx_memc;
}

to-ngx_form_input {
    always;
    cwd ~/git/form-input-nginx-module;
    env PATH '~/git/form-input-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_form_input;

    dep ngx_echo ndk ngx_set_misc ngx_array_var;
}

to-ngx_array_var {
    always;
    cwd ~/git/array-var-nginx-module;
    env PATH '~/git/array-var-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_array_var;

    dep ngx_echo ndk ngx_set_misc;
}

to-ngx_postgres {
    always;
    cwd ~/git/postgres-nginx-module;
    env PATH '~/git/postgres-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_postgres;

    dep ngx-postgres-build-script;
    dep ngx_echo ngx_lua ngx_eval ngx_rds_json;
    dep ndk ngx_set_misc ngx_form_input ngx_coolkit;
    dep ngx_auth_request run-postgres;
}

to-ngx_encrypted_session {
    always;
    cwd ~/git/encrypted-session-nginx-module;
    env PATH '~/git/encrypted-session-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_encrypted_session;

    dep ngx_echo ndk ngx_set_misc;
}

to-ngx_iconv {
    always;
    cwd ~/git/iconv-nginx-module;
    env PATH '~/git/iconv-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_iconv;

    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}

to-ngx_coolkit {
    always;
    cwd ~/git/coolkit-nginx-module;
    env PATH '~/git/coolkit-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT '-O3 -funsigned-char';
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env LD_PRELOAD '';
    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build.sh $nginx_version )';
    sh 'nginx -V';
    sh 'killall nginx || exit 0';
    sh 'prove -I../test-nginx/lib -r t || exit 0';


    dep nginx-module-test ngx_coolkit;

    dep ngx-coolkit-build-script;
    dep ngx_echo ndk ngx_set_misc ngx_lua ngx_rds_json;
}


ngx-postgres-build-script {
    file ~/git/postgres-nginx-module/util/build.sh;
    test 'test -x ~/git/postgres-nginx-module/util/build.sh';
    cwd ~/git/postgres-nginx-module/util;
    fetch 'http://agentzh.org/misc/nginx/ngx-postgres-build.sh';
    sh 'mv ngx-postgres-build.sh build.sh && chmod +x build.sh';
}

ngx-coolkit-build-script {
    file ~/git/coolkit-nginx-module/util/build.sh;
    test 'test -x ~/git/coolkit-nginx-module/util/build.sh';
    cwd ~/git/coolkit-nginx-module/util;
    fetch 'http://agentzh.org/misc/nginx/ngx-coolkit-build.sh';
    sh 'mv ngx-coolkit-build.sh build.sh && chmod +x build.sh';
}

valgrind {
    prog valgrind;
    yum valgrind;
}

opsboy {
    git git://github.com/agentzh/opsboy.git ~/git/opsboy;
    dep cc parse-recdescent tt2;
}

tt2 {
    test 'perl -MTemplate -e1';
    yum p5-Template-Toolkit;
}

parse-recdescent {
    test 'perl -MParse::RecDescent -e1';
    yum p5-Parse-RecDescent;
}


build-ngx_lua {
    always;
    cwd ~/git/lua-nginx-module;
    env PATH '~/git/lua-nginx-module/work/nginx/sbin:$PATH';

    env TEST_NGINX_EVENT_TYPE '';
    env MOCKEAGAIN '';

    env TEST_NGINX_USE_STAP '';

    env NGX_BUILD_CC gcc47;
    env NGX_BUILD_OPT -O1;
    env NGX_BUILD_JOBS $jobs;
    env NGX_BUILD_DTRACE '';

    env TEST_NGINX_CHECK_LEAK '';

    env TEST_NGINX_USE_HUP '';

    env TEST_NGINX_SLEEP 0.015;
    env TEST_NGINX_USE_VALGRIND '';

    sh 'PAGER= git log HEAD^..HEAD';

    sh 'if [ -n "$force" -a "$force" != "0" ]; then rm -rf buildroot/nginx-$nginx_version*; test -f config && touch config || exit 0; fi';

    sh 'bash ./util/build2.sh $nginx_version || ( [ -z "$force" -o "$force" = "0" ] && touch config && bash ./util/build2.sh $nginx_version )';
    sh 'nginx -V';



    dep nginx-module-test ngx_lua;

    dep run-memcached run-redis run-mysql mockeagain;
    dep pcrejit ndk ngx_set_misc ngx_auth_request;
    dep ngx_echo ngx_memc ngx_headers_more;
    dep ngx_drizzle;
    dep ngx_rds_json ngx_coolkit;
}

yum-utils {
    prog debuginfo-install;
    yum yum-utils;
}

wget {
    prog wget;
    yum wget;
}

tar {
    prog tar;
    yum install tar;
}

